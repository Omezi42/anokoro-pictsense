<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>あの頃のピクトセンス</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900 h-screen w-screen overflow-hidden font-sans select-none">

    <!-- ロビー画面 (初期表示) -->
    <div id="lobby-screen" class="absolute inset-0 z-50 bg-blue-50 flex flex-col items-center justify-center p-4">
        <div class="bg-white p-8 rounded-xl shadow-xl max-w-md w-full border border-gray-200">
            <h1 class="text-3xl font-bold mb-6 text-center text-yellow-600 drop-shadow-sm">あの頃のピクトセンス</h1>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-gray-600 mb-1">ユーザー名</label>
                    <input type="text" id="username-input" class="w-full bg-gray-50 border border-gray-300 rounded p-2 focus:border-yellow-500 focus:outline-none text-gray-800" placeholder="例: 山本伊吹">
                </div>
                <div>
                    <label class="block text-sm text-gray-600 mb-1">ルームID</label>
                    <input type="text" id="room-id-input" class="w-full bg-gray-50 border border-gray-300 rounded p-2 focus:border-yellow-500 focus:outline-none text-gray-800" placeholder="例: ankr">
                </div>

                <!-- ルーム設定 (チェックボックス) -->
                <div class="bg-gray-50 p-3 rounded border border-gray-200 text-sm space-y-2">
                    <p class="text-gray-500 text-xs mb-2 text-center">ルーム設定 (作成時のみ適用)</p>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="opt-search" class="form-checkbox text-yellow-600" checked>
                        <span>辞書検索 ON</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="opt-show-start" class="form-checkbox text-yellow-600" checked>
                        <span>描画前イラスト表示</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="opt-show-result" class="form-checkbox text-yellow-600" checked>
                        <span>結果発表時イラスト表示</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="opt-flow" class="form-checkbox text-yellow-600" checked>
                        <span>流れるコメント</span>
                    </label>
                    <label class="flex items-center space-x-2 cursor-pointer">
                        <input type="checkbox" id="opt-hint" class="form-checkbox text-yellow-600" checked>
                        <span>お題ヒント (文字数)</span>
                    </label>
                </div>

                <button id="join-btn" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-3 rounded transition transform hover:scale-105 shadow-md">
                    入室する
                </button>
            </div>
        </div>
    </div>

    <!-- ゲーム画面 -->
    <div id="game-screen" class="hidden h-full flex-col bg-gray-100">
        
        <!-- 上部エリア (70%) -->
        <div class="h-[70%] flex flex-col relative bg-gray-200 border-b border-gray-300">
            
            <!-- ステータスバー -->
            <div class="h-12 bg-white flex items-center justify-between px-4 z-20 shadow-sm border-b border-gray-200">
                <div class="flex items-center space-x-3">
                    <span class="font-bold text-gray-700 text-lg">Room: <span id="disp-room-id" class="text-blue-600"></span></span>
                    <span id="game-status-text" class="text-xs font-bold bg-gray-200 text-gray-600 px-2 py-1 rounded-full">待機中</span>
                    <span id="timer-display" class="text-xl font-mono text-red-500 font-bold hidden">100</span>
                </div>
                
                <!-- お題表示エリア (中央) -->
                <div id="topic-area" class="absolute left-1/2 transform -translate-x-1/2 text-center pointer-events-none w-full">
                    <span id="topic-text" class="text-2xl font-bold tracking-widest text-gray-800 drop-shadow-md bg-white/90 px-6 py-1 rounded-full border-2 border-yellow-400">---</span>
                </div>

                <div class="flex items-center space-x-2">
                    <button id="ranking-btn" class="text-sm bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded shadow">
                        <i class="fas fa-trophy"></i> 順位
                    </button>
                    <button id="leave-btn" class="text-sm bg-gray-400 hover:bg-gray-500 text-white px-3 py-1 rounded shadow">退室</button>
                </div>
            </div>

            <!-- キャンバスエリア -->
            <div class="flex-1 relative flex items-center justify-center bg-gray-200 overflow-hidden" id="canvas-container">
                <!-- 流れるコメントレイヤー -->
                <div id="flowing-comments-layer" class="absolute inset-0 pointer-events-none z-10 overflow-hidden"></div>
                
                <!-- キャンバス本体 -->
                <canvas id="drawing-canvas" width="800" height="450" class="bg-white shadow-md cursor-crosshair touch-none" style="max-width: 100%; max-height: 100%; aspect-ratio: 16/9;"></canvas>

                <!-- ゲーム開始ボタン (オーナーのみ) -->
                <div id="start-game-overlay" class="absolute inset-0 bg-white bg-opacity-60 flex items-center justify-center z-30 hidden backdrop-blur-sm">
                    <button id="start-game-btn" class="bg-green-500 hover:bg-green-600 text-white text-2xl font-bold py-4 px-12 rounded-full shadow-xl animate-bounce">
                        GAME START
                    </button>
                </div>
            </div>

            <!-- ツールバー (描画者のみ表示) -->
            <div id="toolbar" class="h-auto bg-white border-t border-gray-300 p-2 flex flex-wrap items-center justify-center gap-2 z-20 hidden shadow-inner">
                
                <!-- カラーパレット -->
                <div class="flex space-x-1" id="color-palette">
                    <!-- JSで生成 -->
                </div>
                
                <div class="w-px h-8 bg-gray-300 mx-1"></div>

                <!-- 機能ツール -->
                <input type="color" id="color-picker" class="w-8 h-8 p-0 border border-gray-300 rounded cursor-pointer" value="#000000">
                
                <div class="flex items-center space-x-1 bg-gray-100 border border-gray-300 rounded px-2 py-1">
                    <i class="fas fa-circle text-xs text-gray-500"></i>
                    <input type="range" id="line-width" min="1" max="20" value="3" class="w-20 accent-blue-500">
                    <i class="fas fa-circle text-lg text-gray-500"></i>
                </div>

                <button id="eraser-btn" class="tool-btn bg-gray-100 border border-gray-300 hover:bg-gray-200 text-gray-700 p-2 rounded transition" title="消しゴム">
                    <i class="fas fa-eraser"></i>
                </button>
                <button id="clear-btn" class="tool-btn bg-red-100 border border-red-200 hover:bg-red-200 text-red-600 p-2 rounded transition" title="全消し">
                    <i class="fas fa-trash"></i>
                </button>
                
                <div class="w-px h-8 bg-gray-300 mx-1"></div>

                <button id="show-ref-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm shadow">
                    <i class="fas fa-image"></i> 確認
                </button>
                <button id="pass-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm font-bold shadow">
                    パス
                </button>
            </div>
        </div>

        <!-- 下部エリア (30%) -->
        <div class="h-[30%] flex bg-white">
            <!-- 左カラム: 辞書検索 (35%) -->
            <div id="search-column" class="w-[35%] flex flex-col border-r border-gray-200 hidden">
                <div class="p-2 border-b border-gray-200 bg-gray-50">
                    <input type="text" id="dict-search" class="w-full bg-white border border-gray-300 rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-400 text-gray-800" placeholder="辞書検索...">
                </div>
                <div id="search-results" class="flex-1 overflow-y-auto p-2 space-y-1 text-sm text-gray-700 scrollbar-thin">
                    <!-- 検索結果 -->
                </div>
            </div>

            <!-- 右カラム: チャット/回答 (残り) -->
            <div class="flex-1 flex flex-col w-full bg-white">
                <div class="p-2 border-b border-gray-200 flex gap-2 bg-gray-50">
                    <input type="text" id="chat-input" class="flex-1 bg-white border border-gray-300 rounded px-3 py-2 focus:outline-none focus:border-green-400 text-gray-800" placeholder="回答 または コメント">
                    <button id="chat-send-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded font-bold shadow-sm">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <!-- コメント表示欄 (新しい順) -->
                <div id="chat-history" class="flex-1 overflow-y-auto p-2 space-y-2 flex flex-col scrollbar-thin bg-white">
                    <!-- コメント追加位置 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 画像表示モーダル (修正版) -->
    <div id="image-modal" class="fixed inset-0 z-[60] bg-black bg-opacity-90 hidden flex items-center justify-center p-4">
        <!-- コンテンツエリア: max-h-[85vh] にして上下に余裕を持たせる -->
        <div class="bg-white rounded-lg p-4 max-w-2xl w-full max-h-[85vh] flex flex-col items-center relative shadow-2xl overflow-hidden">
            
            <!-- 1. 見出し -->
            <h2 id="modal-title" class="text-lg font-bold text-gray-600 mb-1 flex-shrink-0">お題は</h2>
            
            <!-- 2. お題名 -->
            <p id="modal-word" class="text-2xl font-bold text-black mb-4 flex-shrink-0 text-center leading-tight"></p>
            
            <!-- 3. 画像エリア: 画像自体の高さを最大50vhに制限して確実に収める -->
            <div class="flex-1 w-full min-h-0 flex items-center justify-center mb-4 overflow-hidden">
                <img id="modal-image" src="" alt="Card Image" class="max-w-full max-h-[50vh] object-contain border border-gray-200 bg-gray-50 shadow-inner">
            </div>

            <!-- 4. 閉じるボタン -->
            <button onclick="document.getElementById('image-modal').classList.add('hidden')" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-8 rounded shadow transition flex-shrink-0 text-sm">
                閉じる
            </button>
        </div>
    </div>

    <!-- ランキングモーダル -->
    <div id="ranking-modal" class="fixed inset-0 z-[70] bg-black bg-opacity-50 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl shadow-2xl max-w-md w-full border border-gray-200 overflow-hidden flex flex-col max-h-[80vh]">
            <div class="p-4 bg-yellow-500 text-white flex justify-between items-center">
                <h2 class="text-xl font-bold"><i class="fas fa-trophy"></i> 現在のランキング</h2>
                <button onclick="document.getElementById('ranking-modal').classList.add('hidden')" class="text-white hover:text-gray-100">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="ranking-list" class="p-4 overflow-y-auto flex-1 space-y-2 bg-gray-50">
                <!-- JSで生成 -->
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>