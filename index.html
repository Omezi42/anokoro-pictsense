<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>あの頃のピクトセンス</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- カスタムCSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }
    </style>
    <!-- ES Module (Firebase / App Logic) -->
    <script type="module" src="app.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- ローディングモーダル -->
    <div id="loading-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
        <div class="text-white text-2xl animate-pulse">読み込み中...</div>
    </div>

    <!-- ロビー画面 -->
    <div id="lobby-screen" class="container mx-auto max-w-lg p-6 mt-10 bg-white rounded-lg shadow-xl">
        <h1 class="text-3xl font-bold text-center mb-6">あの頃のピクトセンス</h1>
        <p class="text-sm text-gray-600 mb-4">「あの頃の自作TCG」のカードイラストをお題にしたお絵描きクイズゲームです。</p>
        <form id="join-form">
            <div class="mb-4">
                <label for="username" class="block text-sm font-medium text-gray-700 mb-1">ユーザー名</label>
                <input type="text" id="username" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="例: 山本伊吹" required>
            </div>
            <div class="mb-6">
                <label for="room-id" class="block text-sm font-medium text-gray-700 mb-1">ルームID</label>
                <input type="text" id="room-id" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="例: ankr (英数字)" required>
            </div>

            <fieldset class="mb-6 border-t pt-4">
                <legend class="text-lg font-medium text-gray-900 mb-2">カスタムルール</legend>
                <p class="text-sm text-gray-500 mb-3">（ルーム作成時のみ適用されます）</p>
                <div class="space-y-3">
                    <div class="relative flex items-start">
                        <div class="flex items-center h-5">
                            <input id="rule-dictionary-search" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="rule-dictionary-search" class="font-medium text-gray-700">辞書検索を許可する</label>
                            <p class="text-gray-500">回答者がお題の辞書を検索できます。</p>
                        </div>
                    </div>
                    <div class="relative flex items-start">
                        <div class="flex items-center h-5">
                            <input id="rule-show-image-before" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="rule-show-image-before" class="font-medium text-gray-700">描画前にイラスト表示 (出題者)</label>
                            <p class="text-gray-500">ターン開始時、出題者にお題のカード画像を表示します。</p>
                        </div>
                    </div>
                    <div class="relative flex items-start">
                        <div class="flex items-center h-5">
                            <input id="rule-show-image-after" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" checked>
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="rule-show-image-after" class="font-medium text-gray-700">結果発表時にイラスト表示 (全員)</label>
                            <p class="text-gray-500">正解が出た後、全員にお題のカード画像を表示します。</p>
                        </div>
                    </div>
                    <div class="relative flex items-start">
                        <div class="flex items-center h-5">
                            <input id="rule-flowing-comments" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" checked>
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="rule-flowing-comments" class="font-medium text-gray-700">流れるコメント</label>
                            <p class="text-gray-500">チャットや回答がキャンバス上を流れます。</p>
                        </div>
                    </div>
                    <div class="relative flex items-start">
                        <div class="flex items-center h-5">
                            <input id="rule-word-hint" type="checkbox" class="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" checked>
                        </div>
                        <div class="ml-3 text-sm">
                            <label for="rule-word-hint" class="font-medium text-gray-700">お題ヒント (文字数)</label>
                            <p class="text-gray-500">回答者にお題の文字数を表示します。</p>
                        </div>
                    </div>
                </div>
            </fieldset>

            <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                入室する
            </button>
        </form>
    </div>

    <!-- ゲーム画面 -->
    <div id="game-screen" class="hidden">
        <!-- ヘッダー -->
        <header class="bg-white shadow-md p-2 sticky top-0 z-10">
            <div class="container mx-auto max-w-6xl flex flex-wrap justify-between items-center">
                <div class="flex items-center space-x-4">
                    <h1 class="text-xl font-bold">ルームID: <span id="room-id-display" class="text-indigo-600"></span></h1>
                    <button id="leave-room-btn" class="text-sm bg-red-500 text-white px-3 py-1 rounded-md hover:bg-red-600">退室</button>
                    <button id="game-start-btn" class="hidden bg-green-500 text-white px-4 py-1 rounded-md font-semibold hover:bg-green-600">ゲーム開始</button>
                </div>
                <!-- ステータスバー（お題表示） -->
                <div id="status-bar" class="w-full md:w-auto mt-2 md:mt-0 bg-gray-100 p-2 rounded-md text-center">
                    <span class="font-semibold">お題: </span>
                    <span id="current-word-display" class="text-lg font-bold text-gray-800">待機中...</span>
                </div>
            </div>
        </header>

        <main class="container mx-auto max-w-6xl p-4 mt-4">
            <div class="flex flex-col lg:flex-row gap-4">
                
                <!-- メイン描画エリア -->
                <div class="flex-grow lg:w-2/3">
                    <!-- キャンバスコンテナ (アスペクト比 16:9) -->
                    <div id="canvas-container" class="relative w-full max-w-full bg-white rounded-lg shadow-lg overflow-hidden">
                        <!-- 流れるコメント用コンテナ -->
                        <div id="comment-flow-container" class="absolute inset-0 z-10 pointer-events-none overflow-hidden">
                            <!-- コメントはJSで追加 -->
                        </div>
                        <!-- 描画キャンバス -->
                        <canvas id="drawing-canvas" width="800" height="450">
                            お使いのブラウザはCanvasをサポートしていません。
                        </canvas>
                    </div>

                    <!-- 描画ツールバー (出題者のみ表示) -->
                    <div id="drawing-toolbar" class="hidden bg-gray-100 p-3 mt-4 rounded-lg shadow-md space-y-3">
                        <div class="flex flex-wrap items-center gap-3">
                            <!-- 色ピッカー -->
                            <label for="color-picker" class="text-sm font-medium">色:</label>
                            <input type="color" id="color-picker" value="#000000" class="h-8 w-10 border-none rounded-md cursor-pointer">
                            
                            <!-- クイックカラーパレット -->
                            <div id="quick-color-palette" class="flex gap-1">
                                <button class="quick-color w-6 h-6 rounded-full border-2 border-gray-400" style="background-color: #000000;" data-color="#000000"></button>
                                <button class="quick-color w-6 h-6 rounded-full" style="background-color: #EF4444;" data-color="#EF4444"></button>
                                <button class="quick-color w-6 h-6 rounded-full" style="background-color: #3B82F6;" data-color="#3B82F6"></button>
                                <button class="quick-color w-6 h-6 rounded-full" style="background-color: #22C55E;" data-color="#22C55E"></button>
                                <button class="quick-color w-6 h-6 rounded-full" style="background-color: #F97316;" data-color="#F97316"></button>
                                <button class="quick-color w-6 h-6 rounded-full" style="background-color: #EC4899;" data-color="#EC4899"></button>
                                <button class="quick-color w-6 h-6 rounded-full" style="background-color: #FFFFFF; border: 1px solid #ccc;" data-color="#FFFFFF"></button>
                            </div>
                            
                            <!-- 消しゴムボタン -->
                            <button id="eraser-btn" class="px-3 py-1 bg-white border border-gray-300 rounded-md text-sm hover:bg-gray-50">消しゴム</button>
                        </div>
                        
                        <div class="flex flex-wrap items-center gap-3">
                            <!-- 太さスライダー -->
                            <label for="line-width-slider" class="text-sm font-medium">太さ:</label>
                            <input type="range" id="line-width-slider" min="1" max="50" value="5" class="flex-grow max-w-xs cursor-pointer">
                            <span id="line-width-display" class="text-sm w-8 text-right">5</span>
                        </div>

                        <!-- ★修正: 「お題確認」ボタンを追加 -->
                        <div class="flex flex-wrap items-center gap-3 border-t pt-3">
                            <button id="clear-canvas-btn" class="px-3 py-1 bg-yellow-400 text-gray-800 rounded-md text-sm font-medium hover:bg-yellow-500">全消し</button>
                            <button id="pass-btn" class="px-3 py-1 bg-blue-500 text-white rounded-md text-sm font-medium hover:bg-blue-600">パス (お題変更)</button>
                            <button id="check-word-btn" class="px-3 py-1 bg-gray-400 text-white rounded-md text-sm font-medium hover:bg-gray-500">お題確認</button>
                        </div>
                    </div>

                    <!-- 辞書検索エリア (カスタムルール) -->
                    <div id="dictionary-search-container" class="hidden bg-gray-100 p-3 mt-4 rounded-lg shadow-md">
                        <label for="dictionary-search-input" class="text-sm font-medium">辞書検索:</label>
                        <input type="text" id="dictionary-search-input" class="w-full px-2 py-1 border border-gray-300 rounded-md mt-1" placeholder="カード名の一部を入力...">
                        <div id="dictionary-search-results" class="mt-2 max-h-32 overflow-y-auto bg-white border rounded-md">
                            <!-- 検索結果がここに入る -->
                        </div>
                    </div>
                </div>

                <!-- サイドバー (スコア＆チャット) -->
                <aside class="lg:w-1/3 space-y-4">
                    <!-- スコアボード -->
                    <div class="bg-white p-4 rounded-lg shadow-lg">
                        <h2 class="text-xl font-bold mb-3 border-b pb-2">スコアボード</h2>
                        <div id="scoreboard-container" class="space-y-2 max-h-48 overflow-y-auto">
                            <!-- スコアはJSで追加 -->
                        </div>
                    </div>
                    
                    <!-- チャット/回答エリア -->
                    <div class="bg-white p-4 rounded-lg shadow-lg flex flex-col h-[400px]">
                        <h2 class="text-xl font-bold mb-3 border-b pb-2">チャット & 回答</h2>
                        <div id="messages-container" class="flex-grow overflow-y-auto mb-3 bg-gray-50 p-2 rounded-md">
                            <!-- メッセージはJSで追加 -->
                        </div>
                        <form id="answer-form" class="flex gap-2">
                            <input type="text" id="answer-input" class="flex-grow px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" placeholder="回答またはチャットを入力..." required>
                            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-md font-semibold hover:bg-indigo-700">送信</button>
                        </form>
                    </div>
                </aside>

            </div>
        </main>
    </div>

    <!-- 結果モーダル -->
    <div id="result-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-40 hidden">
        <div class="bg-white p-8 rounded-lg shadow-2xl text-center max-w-md w-full">
            <h2 id="result-title" class="text-3xl font-bold mb-4 text-green-600">正解！</h2>
            <p id="result-winner" class="text-lg mb-2"><strong>山本伊吹</strong> さんが正解しました！</p>
            <p id="result-word" class="text-2xl font-semibold mb-4 text-indigo-700"></p>
            <p id="result-points" class="text-xl mb-6">出題者と正解者に <strong>+80</strong> ポイント！</p>
            <!-- お題イラスト表示エリア -->
            <div id="result-image-container" class="mb-6 hidden">
                <img id="result-image" src="" alt="お題のイラスト" class="max-w-xs mx-auto rounded-md shadow-md">
            </div>
            <p class="text-gray-500 animate-pulse">5秒後に次のターンが始まります...</p>
        </div>
    </div>

    <!-- お題イラスト確認モーダル (出題者用) -->
    <div id="show-image-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-40 hidden">
        <div class="bg-white p-6 rounded-lg shadow-2xl text-center max-w-md w-full">
            <h2 class="text-2xl font-bold mb-4">お題の確認</h2>
            <p class="text-lg mb-4">お題は「<strong id="show-image-word" class="text-indigo-700"></strong>」です。</p>
            <img id="show-image-img" src="" alt="お題のイラスト" class="max-w-xs mx-auto rounded-md shadow-md mb-6">
            <button id="show-image-close-btn" class="bg-indigo-600 text-white px-6 py-2 rounded-md font-semibold hover:bg-indigo-700">閉じる</button> <!-- ★描画開始 -> 閉じる に変更 -->
        </div>
    </div>

</body>
</html>